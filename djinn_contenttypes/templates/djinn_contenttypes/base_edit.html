{% extends "base.html" %}
{% load i18n auth_tags bootstrap djinn_contenttypes pgcomment_tags %}

{% block body_class %}ct {{ object.ct_name }} edit{% endblock %}

{% block container %}

{% block header %}
<header>
  <h1>
    {% block title %}
    {% with ct_label=view.ct_label %}
    {% if object and not object.is_tmp %}
    {% blocktrans %}Edit {{ ct_label }}{% endblocktrans %}
    {% else %}
    {% blocktrans %}Add {{ ct_label }}{% endblocktrans %}
    {% endif %}
    {% endwith %}
    {% endblock title %}
  </h1>
</header>
{% block metainfo %}
<div class="meta-info">
  {% if not object.is_tmp %}
  {% if object.is_publishable %}
  {% if object.publish_from %}
  {# Translators: metadata publication date #}
  {% trans "Published on" %}: {{ object.publish_from }},
  {% else %}
  {# Translators: metadata status #}
  {% trans "Status" %}: {% trans "draft" %},
  {% endif %}
  {% endif %}
  {% endif %}
  {# Translators: metadata last changed #}
  {% trans "Last change" %}: {{ object.changed }}, 
  {# Translators: metadata reactions #}
  {% trans "Reactions" %}: {% comment_count_for user object %}
</div>
{% endblock metainfo %}
{% endblock header %}

{% block form_preamble %}
{% endblock %}

{% block form %}

<form action="" method="POST" 
      id="editform" {% block form_class %}{% endblock %}>

  {{ form.media }}
  {% csrf_token %}

  {% block errors %}
  {% if form.errors %}
  <div class="alert alert-error">
    <strong>{% trans "Please correct the following errors" %}</strong>
    <ul class="basic-list">    
      {% for field in form %}
      {% if field.errors %}
      <li><strong>{{ field.label }}</strong>: {{ field.errors }}</li>
      {% endif %}
      {% endfor %}    
    </ul>
  </div>
  {% endif %}
  {% endblock errors %}

  {% block help %}
  {% if form.help %}
  <div class="general-help alert alert-info">
  {{ form.help|safe }}
  </div>
  {% endif %}
  {% endblock help %}

  {% block formfields %}
  {{ form|bootstrap }}
  {% endblock %}

  {% block extra_formfields %}{% endblock %}

  {% block formcontrols %}
  <div class="btn-group form-actions">

    {% block savecontrols %}
    {% if not object %}
        <button class="btn btn-primary protected save-action" type="submit"
                value="save" name="action">
          {% trans "Save and publish" %}
        </button>
        <button class="btn btn-primary protected save-action" type="submit"
                value="save_as_concept" name="action">
          {% trans "Save as concept" %}
        </button>
    {% else %}
      {% if not object.is_published and not object.is_scheduled %}
        <button class="btn btn-primary protected save-action" type="submit"
                value="save_as_concept" name="action">
          {% trans "Save as concept" %}
        </button>
        <button class="btn btn-primary protected save-action" type="submit"
                value="save" name="action">
          {% trans "Save and publish" %}
        </button>
      {% else %}
        <button class="btn btn-primary protected save-action" type="submit"
                value="save" name="action">
          {% trans "Save" %}
        </button>
      {% endif %}
    {% endif %}

    {% endblock %}
    <button class="btn protected cancel-action" type="submit" 
            value="cancel" name="action">
      {% trans "Cancel" %}
    </button>
    {% if object and not object.is_tmp %}
    {% with perm=object|delete_permission_id %}
    {% ifpermission object request.user perm %}
    <a class="btn btn-danger delete-action"
       data-toggle="modal"
       href="{{ view.delete_url }}"
       data-target="#MyModal">
      {% block delete_label %}
      {% with object_name=view.ct_label %}
      {% blocktrans %}Delete this {{ object_name }}{% endblocktrans %}
      {% endwith %}
      {% endblock %}
    </a>
    {% endifpermission %}
    {% endwith %}
    {% endif %}
  </div>
  {% endblock %}
  {% block formfooter %}{% endblock %}
</form>
{% endblock form %}

{% endblock container %}
